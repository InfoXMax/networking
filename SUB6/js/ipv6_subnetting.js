var drop_down="";for(i=0;i<120;i++)drop_down+="<option value="+(i+8)+">/"+(i+8)+"</option>";function calculate(){var e=document.getElementById("ip").value,n=(e=e.replace(/\s/g,"")).split("/");if(e=n[0],n=n[1],!checkipv6(e))return document.getElementById("address").innerHTML="<span class='error_message'>This does not look like a valid IPv6 address</span>",document.getElementById("first").innerHTML="",document.getElementById("last").innerHTML="",document.getElementById("expanded").innerHTML="",document.getElementById("64s").innerHTML="",void(document.getElementById("prefix").innerHTML="");e=formatipv6preferred(e),document.getElementById("address").innerHTML=e+"/"+n;var t=expand(e);document.getElementById("expanded").innerHTML=t+"/"+n,document.getElementById("64s").innerHTML=Math.pow(2,64-n);var r=findprefix(n)+"::";r=expand(r);var d=bitand(document.getElementById("prefix").innerHTML=r,t);document.getElementById("first").innerHTML=d,document.getElementById("last").innerHTML=last(r,d)}function subnet_subnet(){var e=document.getElementById("subnets").value,n=document.getElementById("ip").value,t=(n=n.replace(/\s/g,"")).split("/");if(n=expand(t[0]),t=t[1],checkipv6(n))if(0!=splitnewslash(t,e)){var r=splitnewslash(t,e),d=Math.pow(2,r-t),a=findprefix(t)+"::",i=bitand(a=expand(a),n),s=(i=expand(i)).replace(/:/g,"");s=new BigInteger(s,16);var o=new BigInteger("2").pow(128-r),l=new Array;l[0]=s.toString(16);for(var p=1;p<d&&(l[p]=s.add(o).toString(16),s=s.add(o),!(999<p));p++);var f="<h5>To get at least "+e+" new subnets divide "+formatipv6preferred(n)+"/"+t+" into "+d+" new subnets.</h5><h6>Each of these subnets is a /"+r+" containing "+Math.pow(2,64-r)+" /64s.</br></br>The new subnets are as follows: </h6><p>";for(p=0;p<d&&(f+=formatipv6preferred(biginttoipv6(l[p]))+"/"+r+"<br>",!(999<p));p++);f+="</p>",document.getElementById("facts").innerHTML="",document.getElementById("subnetted").innerHTML=f}else document.getElementById("facts").innerHTML="</br><p align='center' class='error_message'>Looks like the given IPv6 network cannot be split into this many new subnets</p>";else document.getElementById("facts").innerHTML="<p align='center'></br><span class='error_message'>This looks like an invalid IPv6 address</span></p>"}function subnet_slashes(){var e=document.getElementById("slashes").value,n=document.getElementById("ip").value,t=(n=n.replace(/\s/g,"")).split("/");if(n=expand(t[0]),t=parseInt(t[1]),checkipv6(n)){var r=Math.pow(2,e-t);if(e<t)document.getElementById("facts").innerHTML="</br><p align='center' class='error_message'><span>Make sure the selected slashes fit into the given network. The selected slash should have a larger numeric value than the original network's slash.</span></p>";else{var d=findprefix(t)+"::",a=bitand(d=expand(d),n),i=(a=expand(a)).replace(/:/g,"");i=new BigInteger(i,16);var s=new BigInteger("2").pow(128-e),o=new Array;o[0]=i.toString(16);for(var l=1;l<r&&(o[l]=i.add(s).toString(16),i=i.add(s),!(999<l));l++);var p="<p align='center'><b>Subnetting "+formatipv6preferred(n)+"/"+t+" into /"+e+"s gives "+r+" subnets, all of which have "+Math.pow(2,64-e)+" /64s.</b></p><p>";for(l=0;l<r&&(p+=formatipv6preferred(biginttoipv6(o[l]))+"/"+e+"<br>",!(999<l));l++);p+="</p>",document.getElementById("subnetted").innerHTML=p,document.getElementById("facts").innerHTML=""}}else document.getElementById("facts").innerHTML="<p align='center'></br><span class='error_message'>This looks like an invalid IPv6 address</span></p>"}function biginttoipv6(e){for(var n=[],t=0;t<8;t++)n.push(e.slice(4*t,4*(t+1)));return n.join(":")}function splitnewslash(e,n){for(var t=0;t<128-e;t++)if(n<=Math.pow(2,t))return parseInt(e)+t;return!1}function last(e,n){n=n.split(":"),e=e.split(":"),anded=new Array;for(var t=0;t<8;t++)n[t]=parseInt(n[t],16),e[t]=parseInt(e[t],16),e[t]=65535^e[t],anded[t]=e[t]^n[t],anded[t]=anded[t].toString(16);return anded.join(":")}function bitand(e,n){e=e.split(":"),n=n.split(":"),anded=new Array;for(var t=0;t<8;t++)e[t]=parseInt(e[t],16),n[t]=parseInt(n[t],16),anded[t]=e[t]&n[t],anded[t]=anded[t].toString(16);return anded.join(":")}function findprefix(e){for(var n=e,t="",r=0;r<n;r++)t+="1",(r+1)%16==0&&(t+=":");for(t=t.split(":");t[t.length-1].length<16;)t[t.length-1]+="0";for(r=0;r<t.length;r++)t[r]=parseInt(t[r],2),t[r]=t[r].toString(16);return t.join(":")}function checkipv6(e){return/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))\s*$/.test(e)}function formatipv6preferred(e){var n,t="Not a valid IPv6 Address";return checkipv6(e)&&(trimcolonsfromends(n=e.toLowerCase().split(":")),fillemptysegment(n),stripleadingzeroes(n),removeconsecutivezeroes(n),t=assemblebestrepresentation(n)),t}function trimcolonsfromends(e){var n=e.length;""==e[0]&&""==e[1]&&""==e[2]?(e.shift(),e.shift()):""==e[0]&&""==e[1]?e.shift():""==e[n-1]&&""==e[n-2]&&e.pop()}function fillemptysegment(e){var n,t=8;for(-1!=e[e.length-1].indexOf(".")&&(t=7),n=0;n<t;n++)if(""==e[n]){e[n]="0";break}for(;e.length<t;)e.splice(n,0,"0")}function stripleadingzeroes(e){var n=e.length;for(i=0;i<n;i++){for(segs=e[i].split(""),j=0;j<3&&"0"==segs[0]&&1<segs.length;j++)segs.splice(0,1);e[i]=segs.join("")}}function removeconsecutivezeroes(e){var n,t=-1,r=0,d=!1,a=0,i=-1;for(n=0;n<8;n++)d?"0"==e[n]?a+=1:(d=!1,r<a&&(t=i,r=a)):"0"==e[n]&&(d=!0,i=n,a=1);r<a&&(t=i,r=a),1<r&&e.splice(t,r,"")}function assemblebestrepresentation(e){var n="",t=e.length;for(""==e[0]&&(n=":"),i=0;i<t&&(n+=e[i],i!=t-1);i++)n+=":";return""==e[t-1]&&(n+=":"),n}function expand(e){var n="",t="";if(-1==e.indexOf("::"))n=e;else{for(var r=e.split("::"),d=0,a=0;a<r.length;a++)d+=r[a].split(":").length;for(n+=r[0]+":",a=0;a<8-d;a++)n+="0000:";n+=r[1]}var i=n.split(":");for(a=0;a<8;a++){for(;i[a].length<4;)i[a]="0"+i[a];t+=7!=a?i[a]+":":i[a]}return t}document.getElementById("slashes").innerHTML=drop_down;